### LLM-утилита для форматирования текста
Данная утилита представляет из себя скрипт для инференса LLM с заготовленным встроенным промптом, предназначенный для форматирования замусоренного текста, который был получен после парсинга html-страницы. Помимо основного скрипта, утилита также содержит скрипт постпроцессинга, который удаляет ненужные md-артифакты из сгенерированного моделью текста, а также разбивает полученный текст на чанки. Пример скрипта для запуска инференса приведён в файле **launch_qwen_formatter.sh**

### Установка
```bash
git clone https://github.com/myPar/LLM_doc_filter.git
cd LLM_doc_filter
pip install -r requirements.txt
```
Теперь можно использовать:
```bash
sbatch launch_qwen_formatter.sh
```
постпроцессинг:
```bash
python postprocessor.py --dir_path=filtered_docs
```

#### Использование
**Инференс**, аргументы:

* __model_path__ - путь до модели
* __file_path__ - путь до файла, который будет обработан
* __output__ - путь до папки с результатами генерации (**output** - по умолчанию)
* __dir_path__ - директория из которой будут браться файлы для обработки. игнорируется, если file_path определён.
* __sys_prompt__ - путь до файла с системным промптом (**sys_prompt.txt** - по умолчанию)
* __chunk_size__ - размер чанка текста, который будет подан модели на 1 итерации инференса. Определён в виду ограниченного размера контекста модели и максимального количества генерируемых токенов.

Пример
```bash
python qwen_doc_filter.py --model_path=/storage0/bi/models/Qwen2.5-14B-Instruct/ --dir_path=data --output=filtered_dir
```
Файлы для обработки будут взяты из директории **data**, а результаты будут сохранены в директорию **filtered_dir**. Здесь показан пример использования модели Qwen2.5-14B-Instruct

После того, как модель отработала, можно произвести постпроцессинг результатов, чтобы почистить лишние артефакты и разбить текст на чанки.

**Постпроцессинг**, аргументы:

* __file_path__ - путь до файла, который будет обработан
* __output__ - путь до папки с результатами постпроцессинга (**postprocess_dir** - по умолчанию). игнорируется, если inplace=True
* __dir_path__ - директория из которой будут браться файлы для обработки. игнорируется, если file_path определён.

* __inplace__ - булевый флаг указывающий, будут ли файлы отредактированы на месте или нет. (по умолчанию - **False**)

Примеры
```
python postprocessor.py --dir_path=filtered_docs/filtered_dir/
```
файлы для постпроцессинга будут взяты из директории filtered_docs/filtered_dir/ и сохранены в директорию **postprocess_dir** (по умолчанию)

```
python postprocessor.py --dir_path=filtered_docs/filtered_dir/ --inplace=True
```
файлы для постпроцессинга будут взяты из директории filtered_docs/ и будут заменены отредактированными (inplace=True).